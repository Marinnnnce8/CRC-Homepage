/*! NBkit - Table | @version 1.0.2 | @author NB Communication Ltd <info@nbcommunication.com> | @copyright 2020 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("uikit"),require("nbkit")):"function"==typeof define&&define.amd?define("nbkittable",["uikit","nbkit"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).NBkitTable=e(t.UIkit,t.NBkit)}(this,(function(t,e){"use strict";return UIkit.component("nbTable",{args:"cls",props:{active:Number,cls:String,clsActive:String,desc:Boolean,sort:Object,usDate:Boolean},data:{active:-1,cls:"",clsActive:"uk-active",clsSorter:"nb-table-sortable",desc:!1,evaluate:20,headers:[],sort:{},usDate:!1},beforeConnect:function(){e.util.profilerStart("NBkit.Table.beforeConnect");var i=t.util.$$("> thead tr",this.$el);i.length&&!t.util.isIE||(this.sort=!1);var s=this.cls?this.cls.split(" "):[];s.length&&!t.util.includes(this.cls,"uk-table-")||s.push("uk-table");var l=e.util.getClassName(this);if(s.push(l),this.sort&&s.push(l+"-sort"),t.util.addClass(this.$el,s.join(" ")),t.util.hasClass(this.$el.parentElement,"uk-overflow-auto")||t.util.wrapAll(this.$el,'<div class="uk-overflow-auto">'),this.sort){t.util.isPlainObject(this.sort)||(this.sort={});for(var r=t.util.$$("> th",i[i.length-1]),a=r.length,n=0;n<a;n++)this.headers.push({$el:r[n],sort:!1});var o=t.util.$$("> tbody > tr",this.$el),u=o.length;if(u>this.evaluate){var h=u.toString().length;this.evaluate=this.evaluate*h,(u=Math.round(u/h))>this.evaluate&&(u=this.evaluate)}a=this.headers.length;for(var c=0,d=void 0,f=void 0;c<a;c++)if(!1!==(d=c in this.sort?this.sort[c]:0)){if(t.util.isFunction(d))this.headers[c].sort=d;else if(t.util.isString(d))(f=["string","number","currency","percent","date"].indexOf(d))>0?this.headers[c].sort=f:d in window&&(this.headers[c].sort=window[d]);else{for(var v=0,b=void 0,g=void 0;v<u;v++)g=(b=t.util.$$("> td",o[v])[c].textContent).replace(/(,|\.|%)/g,""),t.util.isNumeric(b)||t.util.isNumeric(g)?d++:t.util.isNumeric(g.substr(1))?(d++,d++):2===(b.match(/\//g)||[]).length&&this.getDate(b)?(d++,d++,d++,d++,d++):Date.parse(b)&&(d++,d++,d++,d++);this.headers[c].sort=d?d/u:0}t.util.addClass(this.headers[c].$el,this.clsSorter)}}e.util.profilerStop("NBkit.Table.beforeConnect")},connected:function(){if(e.util.profilerStart("NBkit.Table.connected"),this.sort&&this.active>=0){var i=this.headers[this.active].$el;i&&t.util.trigger(i,"click")}e.util.profilerStop("NBkit.Table.connected")},events:[{name:"click",delegate:function(){return"."+this.clsSorter},handler:function(i){if(e.util.profilerStart("NBkit.Table.events.click"),this.sort){var s=this,l=this.$el,r=t.util.$("> tbody",l),a=t.util.$$("> tr",r),n=i.target,o=n.cellIndex,u=this.clsActive,h="asc",c="desc",d=this.desc?!t.util.hasClass(n,c)||!t.util.attr(n,"class"):t.util.hasClass(n,h);t.util.removeClass(t.util.$$("> thead > tr > th, > tbody > tr > td",l),u),t.util.removeClass(t.util.$$("> thead > tr > th",l),c,h),d?t.util.addClass(n,c):t.util.addClass(n,h),t.util.addClass(n,u),a.forEach((function(e){return t.util.addClass(t.util.$$("> td",e)[o],u)}));var f=s.headers[o].sort;a.sort((function(e,i){if(e=t.util.$$("td",e)[o].innerText,i=t.util.$$("td",i)[o].innerText,t.util.isFunction(f))return f(e,i,d);switch(2===f&&(e=e.substr(1),i=i.substr(1)),f){case 0:e=e.toLowerCase(),i=i.toLowerCase();break;case 1:case 2:case 3:e=parseFloat(e.replace(/(,|%)/g,"")),i=parseFloat(i.replace(/(,|%)/g,""));break;case 5:e=new Date(s.getDate(e)).getTime(),i=new Date(s.getDate(i)).getTime();break;case 4:e=new Date(e).getTime(),i=new Date(i).getTime()}return d?e<i?1:-1:e>i?1:-1})),t.util.html(r,a)}e.util.profilerStop("NBkit.Table.events.click")}}],methods:{getDate:function(t){if(2===(t.match(/\//g)||[]).length){var e=t.split("/"),i=e[2].split(" ");if(i.length)return e[2]=i[0],t=[e[this.usDate?1:2],e[this.usDate?2:1],e[0]].join("-"),2===i.length&&(t=[t,i[1]].join("T")),Date.parse(t)?t:""}return""}}})}));
